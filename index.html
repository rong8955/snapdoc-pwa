<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SnapDoc PWA</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", "Segoe UI", Arial; margin: 16px; }
    button { padding: 10px 12px; margin: 6px 6px 6px 0; }
    .row { display: flex; flex-wrap: wrap; gap: 10px; }
    .thumb { width: 140px; border: 1px solid #ddd; border-radius: 12px; padding: 8px; }
    .thumb img { width: 100%; border-radius: 10px; display: block; }
    .thumb small { display: block; margin-top: 6px; color: #666; word-break: break-all; }
    .btns { margin-top: 6px; display: flex; gap: 6px; flex-wrap: wrap; }
    .btns button { padding: 8px 10px; margin: 0; }

    /* Modal */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,.55);
      display: none; align-items: center; justify-content: center;
      z-index: 9999; padding: 16px;
    }
    .modal.show { display: flex; }
    .panel {
      background: #fff; border-radius: 14px; width: min(900px, 100%);
      padding: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.2);
    }
    .panel h3 { margin: 6px 0 10px; }
    .panel .tools { display:flex; gap:8px; flex-wrap: wrap; align-items: center; }
    .panel .tools button { margin: 0; }
    .hint { color:#666; font-size: 14px; margin: 8px 0 0; }

    canvas { width: 100%; height: auto; border-radius: 12px; border: 1px solid #eee; background: #fafafa; }
  </style>
</head>

<body>
  <h2>SnapDoc（無 OCR）</h2>

  <div class="row">
    <input id="picker" type="file" accept="image/*" capture="environment" multiple />
  </div>

  <div class="row" style="margin-top:10px;">
    <button id="exportSinglePdf">匯出：單頁 PDF（目前第 1 頁）</button>
    <button id="exportAllPdf">匯出：多頁合併 PDF</button>
    <button id="exportSinglePng">匯出：單頁 PNG（目前第 1 頁）</button>
    <button id="clearAll">清空全部</button>
  </div>

  <p id="status"></p>
  <div id="gallery" class="row"></div>

  <!-- Modal for Manual/Auto straighten -->
  <div id="editorModal" class="modal" aria-hidden="true">
    <div class="panel">
      <h3>拉直（透視校正）</h3>
      <div class="tools">
        <button id="autoDetectBtn">Auto 自動抓邊</button>
        <button id="applyBtn">套用拉直</button>
        <button id="resetBtn">重設（回原圖）</button>
        <button id="closeBtn">關閉</button>
        <span id="cvState" class="hint"></span>
      </div>
      <p class="hint">手動模式：拖曳 4 個角點對準紙張四角，再按「套用拉直」。</p>
      <canvas id="editorCanvas"></canvas>
    </div>
  </div>

  <!-- pdf-lib -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <!-- OpenCV.js (for Auto/Manual perspective transform) -->
  <script async src="https://docs.opencv.org/4.x/opencv.js"></script>

  <script src="app.js?v=3"></script>
</body>
</html>
